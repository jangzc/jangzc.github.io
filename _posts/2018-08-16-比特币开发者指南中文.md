---
layout:     post
title:      比特币开发者指南(1)--区块链
subtitle:   
date:       2018-08-16
author:     Jang
header-img: img/post-bg-debug.png
catalog: true
tags:
    - BlockChain
---

## 名词
Block Chain: 区块链
UTXO: Unspent Transaction Output, 未花费的交易输出
Genesis Block: 块0, 创世块
SPV: Simplified Payment Verification, 简单支付验证
BIP: Bitcoin Improvement Proposal, 比特币改进提案
Proof Of Work: 工作量证明

## 区块链
区块链提供了比特币的公共账本，这是一个有序时间戳的交易(transaction)记录。该系统用于防止重复花费(双花 double spending)和修改先前的交易记录.

Bitcoin网络中的每个完整节点独立地存取仅包含节点验证过的区块链。当多个节点在其块链中都具有相同的块时，它们被认为达成了共识。这些节点遵循维持共识的验证规则被称为共识规则。本节将介绍BitcoinCore使用的许多共识规则.

## 区块链概述
<img src="https://img-blog.csdn.net/20170706152420194?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FtbWFn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"/>

图中显示了区块链的简化版本。一个或多个新交易的块被收集到一个区块的交易数据部分中。每个交易数据的副本将本哈希，这些哈希值两两配对，再被hash, 直到得到最顶层的一个hash值，这就是一课merkle树的根。

merkle树根存储在这个区块标头中。每个块还存储着先前块的标头的哈希值，这样块将链接在一起。这样可以确保事务无法修改，而不修改记录该事务的块以及所有后续块。

交易记录也被链接在一起。比特币钱包软件给人的感觉是从钱包发送或接收多少聪的比特币，但实际上比特币真的是在交易中流转。每个交易花费先前在一个或多个较早的交易中接收到的多少聪的比特币，因此一个交易的输入是先前交易的输出。

单个交易可以创建多个输出，就像发送到多个地址时的情况一样，但是特定交易的每个输出只能是在区块链中用作输入一次。任何后续的引用都禁止重复花费。

输出绑定到交易标识符(TXID)上，这是验证过的交易的哈希值。

<img src="https://img-blog.csdn.net/20170706152442921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FtbWFn/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"/>

因为特定交易的输出只允许花费一次，那所有包含在区块上的交易输出可以归类为为花费的交易输出(UXTOs)或已花费的交易输出。要想付款有效，只能使用未花费的交易输出UXTOs作为输入。

先不讲比特币交易，若一个交易的输出超过交易的输入，这个交易将会被拒绝-但是若是输入超出输出，这个差值可以作为交易费奖励给创建这个区块的Bitcoin矿工。例如在上图中，每个交易相比它相关的交易输入花费了10000聪，实际上就是支付了10000聪的交易费。

## 工作量证明
区块链是由网络中对等的节点共同维护的，所以Bitcoin要求每个区块需要一定工作量投入确保想篡改历史区块的不诚实节点比想在区块链上创建新区块的诚实节点要付出更大代价.

链接区块在一起使得在不修改所有后面的区块情况下不可能修改此区块中包含的交易。结果，修改特定区块的成本随着添加到区块链中的每个新区块而增加，放大了工作量证明的效果.

Bitcoin中使用的工作量证明利用了密码散列的显式随机特性。一个好的加密哈希算法将任意数据转换成看似随机的数字。如果以任何方式修改数据并且重新得到哈希值，则会产生一个新的看似随机的数字，因此无法修改数据以使哈希数值可被预测。

为了证明你做了一些额外的工作来创建一个区块，你必须创建一个不超过某个值的区块头的散列。例如，如果最大可能的哈希值为2<sup>256</sup>-1, 则可以证明您通过产生哈希值来两两组合最多尝试次数小于2<sup>255</sup>

在上面给出的例子中，平均每个其他尝试都会产生一个成功的哈希。你甚至可以估计给定哈希尝试将生产低于目标阀值的数字的概率。比特币假设一个线性概率，它使得目标阀值越低，平均需要更多的哈希尝试。

新的块会被添加到块链，仅当它们的哈希难度至少与共识协议所期望的难度值相当。每2016个块，比特币网络会使用存储在每个块头中的时间戳来计算生产商一个2016个块的idyige区块和最后一个区块经过的秒数。这个理想值为1209600秒(两周)。

如果生成2016个块需要不到两周的时间，则预期的难度值将按比例增加，当以相同的速率检查散列情况下以便接下来的2016块应该恰好需要两个星期来生成。

